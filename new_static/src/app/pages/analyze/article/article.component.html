<ng-template #textDetailsModal let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Text analysis details</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body p-0">
        <div class="table-responsive">
            <table class="table table-flush">
                <thead class="bg-white">
                <tbody>
                <ng-container *ngFor="let detail of article.textAnalysis[0] | keyvalue">
                    <tr *ngIf="detail.key.includes('text') || detail.key.includes('title')">
                        <th scope="row">
                            {{detail.key}}
                        </th>
                        <th scope="row">
                            {{detail.value}}
                        </th>
                        <th scope="row" width="1%">
                            <i (mouseenter)="showDetailLabel(detail.key)" [ngbPopover]="infoTooltip" placement="right"
                               class="fas fa-info-circle fa-2x c-pointer float-right"
                               style="font-size: 18px;color: #525f7f !important;"></i>
                        </th>
                    </tr>
                </ng-container>
                </tbody>
            </table>
        </div>

    </div>
</ng-template>

<div class="col-md-8 col-12 analyze-container" *ngIf="article">
    <div class="grid">
        <a [href]="sirenUrl" target="_blank">
            <button class="btn btn-icon btn-secondary" style="position: absolute; top: 20px;right: 20px; z-index: 2">
                <span class="btn-inner--text span-fade" style="margin-right: 0">Open Dashboard</span>
                <img class="inner-img" src="assets/img/logos/siren.png" style="height: 20px !important;">
            </button>
        </a>
        <div class="row">
            <div class="col-12">
                <h6 class="heading-small text-muted">Article</h6>
                <label class="form-control-label">Published date</label>
                <p>{{article.date | date}}</p>
                <label class="form-control-label">Headline</label>
                <p>{{article.headline}}</p>
                <label class="form-control-label">Body</label>

                <p *ngIf="!showMore">{{article.body | truncate : 550}}</p>
                <p *ngIf="showMore">{{article.body}}</p>

                <div class="col-12 text-center">
                    <button class="btn btn-sm btn-secondary" *ngIf="!showMore" (click)="showMore = true">Show more
                    </button>
                    <button class="btn btn-sm btn-secondary" *ngIf="showMore" (click)="showMore = false">Show less
                    </button>
                </div>
            </div>

            <!--            <div class="col-md-3 col-12 text-center mt-3">-->
            <!--                <div>-->
            <!--                    <h1 class="text-green m-0" style="font-size: 95px">78%</h1>-->
            <!--                    <h3 class="text-black-50 text-capitalize mt&#45;&#45;3">Trustworthiness</h3>-->
            <!--                </div>-->
            <!--            </div>-->
        </div>
        <hr class="my-4"/>
        <!--        <div class="row">-->
        <!--            <div class="col-12">-->
        <!--                <h6 class="heading-small text-muted d-inline">Text analysis result</h6>-->
        <!--                <i (click)="showTextDetailsModal(textDetailsModal)"-->
        <!--                   class="fas fa-info-circle fa-2x c-pointer float-right"-->
        <!--                   style="font-size: 18px;color: #525f7f !important;"></i>-->
        <!--            </div>-->
        <!--            <div class="col-8 mx-auto">-->
        <!--                &lt;!&ndash;                        <h6 class="heading-small text-muted">Text analysis result</h6>&ndash;&gt;-->
        <!--                <div class="progress-wrapper">-->
        <!--                    <div class="progress-info">-->
        <!--                        <div class="progress-label">-->
        <!--                            <span>Trustworthiness</span>-->
        <!--                        </div>-->
        <!--                        <div class="progress-percentage">-->
        <!--                            <span>{{(article.textAnalysis[0]['1'] * 100).toFixed(2)}}%</span>-->
        <!--                        </div>-->
        <!--                    </div>-->
        <!--                    <div class="progress">-->
        <!--                        <div class="progress-bar bg-success"-->
        <!--                             [ngClass]="getProgressColor(article.textAnalysis[0]['1'] * 100)" role="progressbar"-->
        <!--                             aria-valuemin="0" aria-valuemax="100"-->
        <!--                             [style.width]="article.textAnalysis[0]['1'] * 100 + '%'">-->
        <!--                        </div>-->
        <!--                    </div>-->
        <!--                </div>-->
        <!--            </div>-->
        <!--        </div>-->
        <!--        <hr class="my-4"/>-->

        <div class="row">
            <div class="col-md-4 col-12" style="border-right: 1px solid rgba(0, 0, 0, 0.2)">
                <h6 class="heading-small text-muted">Text analysis <i (click)="showTextDetailsModal(textDetailsModal)"
                                                                      class="fas fa-info-circle c-pointer ml-1"
                                                                      style="font-size: 18px;color: #525f7f !important;"></i>
                </h6>
                <div class="table-responsive">
                    <table class="table table-flush">
                        <tbody>
                        <tr>
                            <th scope="row">
                                Trustworthiness
                            </th>
                            <td>
                                <div class="d-flex align-items-center">
                                    <span class="mr-2">{{(article.textAnalysis[0]['1'] * 100).toFixed(2)}}%</span>
                                    <div>
                                        <div class="progress">
                                            <div class="progress-bar"
                                                 [ngClass]="getProgressColor(article.textAnalysis[0]['1'] * 100)"
                                                 role="progressbar"
                                                 aria-valuemin="0" aria-valuemax="100"
                                                 [style.width]="article.textAnalysis[0]['1'] * 100 + '%'"></div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <!--                <div class="col-8 mx-auto">-->
                    <!--                    &lt;!&ndash;                        <h6 class="heading-small text-muted">Text analysis result</h6>&ndash;&gt;-->
                    <!--                    <div class="progress-wrapper">-->
                    <!--                        <div class="progress-info">-->
                    <!--                            <div class="progress-label">-->
                    <!--                                <span>Trustworthiness</span>-->
                    <!--                            </div>-->
                    <!--                            <div class="progress-percentage">-->
                    <!--                                <span>{{(article.textAnalysis[0]['1'] * 100).toFixed(2)}}%</span>-->
                    <!--                            </div>-->
                    <!--                        </div>-->
                    <!--                        <div class="progress">-->
                    <!--                            <div class="progress-bar bg-success"-->
                    <!--                                 [ngClass]="getProgressColor(article.textAnalysis[0]['1'] * 100)" role="progressbar"-->
                    <!--                                 aria-valuemin="0" aria-valuemax="100"-->
                    <!--                                 [style.width]="article.textAnalysis[0]['1'] * 100 + '%'">-->
                    <!--                            </div>-->
                    <!--                        </div>-->
                    <!--                    </div>-->
                    <!--                </div>-->
                </div>
            </div>
            <div class="col-md-4 col-12">
                <h6 class="heading-small text-muted">Authors</h6>
                <div class="table-responsive">
                    <table class="table table-flush">
                        <tbody>
                        <tr *ngFor="let author of article.authors">
                            <th scope="row">
                                {{author.name}}
                            </th>
                            <td>
                                <div class="d-flex align-items-center">
                                    <span class="mr-2">{{author.fakenessScore}}%</span>
                                    <div>
                                        <div class="progress">
                                            <div class="progress-bar"
                                                 [ngClass]="getProgressColor(author.fakenessScore)"
                                                 role="progressbar"
                                                 aria-valuemin="0" aria-valuemax="100"
                                                 [style.width]="author.fakenessScore + '%'"></div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>

                        <tr *ngIf="article.authors.length === 0">
                            <th colspan="2">
                                No authors found
                            </th>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-md-4 col-12">
                <h6 class="heading-small text-muted">Publishers</h6>
                <div class="table-responsive">
                    <table class="table table-flush">
                        <tbody>
                        <tr *ngFor="let publisher of article.publishers">
                            <th scope="row">
                                {{publisher.name}}
                            </th>
                            <td>
                                <div class="d-flex align-items-center">
                                    <span class="mr-2">{{publisher.fakenessScore}}%</span>
                                    <div>
                                        <div class="progress">
                                            <div class="progress-bar"
                                                 [ngClass]="getProgressColor(publisher.fakenessScore)"
                                                 role="progressbar"
                                                 aria-valuemin="0" aria-valuemax="100"
                                                 [style.width]="publisher.fakenessScore + '%'"></div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>

                        <tr *ngIf="article.publishers.length === 0">
                            <th colspan="2">
                                No publishers found
                            </th>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!--                <div class="col-md-2 col-12 text-center">-->
            <!--                    <div>-->
            <!--                        <h1 class="text-green m-0" style="font-size: 95px">64%</h1>-->
            <!--                        <h3 class="text-black-50 mt&#45;&#45;3">SCORE</h3>-->
            <!--                    </div>-->
            <!--                </div>-->
        </div>
        <hr class="my-4"/>
        <div class="row">
            <div class="col-12">
                <h6 class="heading-small text-muted">Images</h6>
                <div class="row">
                    <!--                    <div class="col-2">-->
                    <!--                        <div class="card bg-light text-white p-0 mr-2">-->
                    <!--                            <img class="card-img"-->
                    <!--                                 src="https://demos.creative-tim.com/argon-dashboard-pro/assets/img/theme/img-1-1000x600.jpg"-->
                    <!--                                 style="height: 100px">-->
                    <!--                            <div class="card-footer text-center">-->
                    <!--                                <div class="row">-->
                    <!--                                    <div class="col-6 mx-auto">-->
                    <!--                                        <button class="btn btn-sm btn-info">Analyze</button>-->
                    <!--                                    </div>-->
                    <!--                                </div>-->
                    <!--                            </div>-->
                    <!--                        </div>-->
                    <!--                    </div>-->
                    <div class="col-12" style="white-space: nowrap;overflow-x: auto;">
                        <img *ngFor="let image of article.images" class="c-pointer img-thumbnail mr-3"
                             (click)="analyzeImage(image)"
                             [src]="image"
                             style="height: 115px">

                        <h4 class="text-muted" *ngIf="article.images.length === 0">
                            No images found
                        </h4>
                    </div>
                </div>
            </div>
        </div>
        <hr class="my-4"/>
        <div class="row">
            <div class="col-12">
                <h6 class="heading-small text-muted">Videos</h6>
                <div class="row">
                    <div class="col-12">
                        <img *ngFor="let video of article.videos" class="c-pointer img-thumbnail mr-3"
                             (click)="analyzeVideo(video)"
                             [src]="embedVideoThumb(video)" style="height: 115px">

                        <!--                    <div class="col-12 mt-4" style="white-space: nowrap;overflow-x: auto;">-->
                        <!--                        <iframe *ngFor="let video of article.videos" class="img-thumbnail" style="height: 150px"-->
                        <!--                                [src]="embedVideo(video)"></iframe>-->
                        <!--                    </div>-->

                        <h4 class="text-muted" *ngIf="article.videos.length === 0">
                            No videos found
                        </h4>
                    </div>
                </div>
            </div>
        </div>
        <hr class="my-4"/>
        <h6 class="heading-small text-muted">Similar news</h6>
        <div class="table-responsive">
            <table class="table table-flush table-hover">
                <thead class="bg-white">
                <tr>
                    <th scope="col">Headline</th>
                    <th scope="col">Publisher</th>
                    <th scope="col">Text Rating</th>
                    <th scope="col" style="width: 1%"></th>
                </tr>
                </thead>
                <tbody>
                <tr class="c-pointer" *ngFor="let news of article.similarNews" (click)="preAnalyzeArticle(news.url)">
                    <th scope="row">
                        {{news.headline}}
                    </th>
                    <th scope="row">
                        {{news.sourceDomain}}
                    </th>
                    <th scope="row" [ngClass]="getScoreColor(news.calculatedRatingDetail.textRating * 100)">
                        {{(news.calculatedRatingDetail.textRating * 100).toFixed(2)}}%
                    </th>
                    <th scope="row" width="1%">
                        <a title="Show news" [href]="news.url" (click)="$event.stopPropagation()" target="_blank"><i
                            class="fas fa-external-link-alt" style="color:#525f7f !important;"></i></a>
                    </th>
                </tr>

                <tr *ngIf="article.similarNews.length === 0">
                    <th colspan="4">
                        No similar news found
                    </th>
                </tr>
                </tbody>
            </table>
        </div>
        <hr class="my-4"/>
        <h6 class="heading-small text-muted">Open data</h6>
        <div class="table-responsive">
            <table class="table align-items-center table-flush">
                <thead class="bg-white">
                <tr>
                    <th scope="col">Name</th>
                    <th scope="col"></th>
                    <th scope="col" style="width: 1%"></th>
                </tr>
                </thead>
                <tbody>
                <ng-container *ngFor="let data of article.openData">
                    <tr [class.bg-white]="data.expand">
                        <th scope="row">
                            {{data.name}}
                        </th>
                        <th scope="row" width="1%">
                            <a title="Show Open Data URL" [href]="data.url" target="_blank"><i
                                class="fas fa-external-link-alt" style="color:#525f7f !important;"></i></a>
                        </th>
                        <th scope="row" width="1%">
                            <a (click)="data.expand = !data.expand">
                                <i *ngIf="!data.expand" class="fas fa-caret-square-down fa-2x c-pointer"></i>
                                <i *ngIf="data.expand" class="fas fa-caret-square-up fa-2x c-pointer"></i>
                            </a>
                        </th>
                    </tr>
                    <ng-container *ngIf="data.expand">
                        <th scope="row" colspan="3" class="p-0">
                            <table class="table">
                                <tbody>
                                <tr>
                                    <td style="white-space: normal">
                                        {{data.text}}
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </th>
                    </ng-container>
                </ng-container>

                <tr *ngIf="article.openData.length === 0">
                    <th scope="row" colspan="2" class="text-center">
                        No Open Data found
                </tr>
                </tbody>
            </table>
        </div>
        <span class="my-4"></span>
    </div>
</div>
