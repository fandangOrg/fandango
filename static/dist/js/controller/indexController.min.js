"use strict";app.controller("indexCtrl",["$scope","$http","$document","errorCode","crUrl","fakeness","feedback","claim","lang","alert","$sce",function(e,t,a,n,l,o,r,s,i,c,d){e.fakenessDone=!1,e.loadingFakeness=!1,e.loadingAnalyzeUrl=!1,e.feedbackSelected=!1,e.showChart=!0,e.highlightedText="",e.selectedText="",e.fakenessColor="",e.full_response={},$(".alert").hide(),e.videoAnalysisUrl=videoAnalysisUrl,e.page={authors:[],publisher:[],url:"",text:"",title:"",date:"",lang:""},e.media={images:[],video:[]};var u=["true","mostly-true","half-true"];angular.element(function(){e.loading=!1}),$("#gaugeFakeness").on("contextmenu",function(){return!1}),e.analyzeUrl=function(){if(!e.page.url)return!1;e.loadingAnalyzeUrl=!0,e.fakenessDone=!1,e.media={images:[],video:[]};var t=e.page.url;l.analyzeUrl(t).then(function(t){console.log(t.data),e.full_response=t.data,e.page.title=t.data.headline,e.page.text=t.data.articleBody,e.page.publisher=t.data.publisher,e.page.authors=t.data.author,e.page.date=t.data.dateCreated,e.page.lang=t.data.language,e.loadingAnalyzeUrl=!1},function(t){e.loadingAnalyzeUrl=!1})},e.showSelectedText=function(){e.selectedText=e.getSelectionText()},e.getSelectionText=function(){if(window.getSelection)try{var t=$("textarea").get(0);return e.highlightedText=t.value.substring(t.selectionStart,t.selectionEnd),e.highlightedText}catch(e){console.log("Cant get selection text")}document.selection&&"Control"!=document.selection.type&&(e.highlightedText=document.selection.createRange().text)},e.sendClaim=function(){console.log(e.selectedText);var t={text:e.selectedText};s.getClaim(t).then(function(t){console.log(t.data),e.claims=t.data},function(e){})},e.saveClaim=function(t){var a={claim:e.selectedText,label:t};s.saveClaim(a).then(function(e){c.showAlert("Success")},function(e){c.showAlert("Error")})},e.getClaimFakeness=function(e){return u.includes(e)?"text-green":"barely-true"===e?"text-blue":"text-red"},e.getAuthorColor=function(e){switch(!0){case e<20:return"text-red";case e<40:return"text-warning";case e<80:return"text-yellow";case e>80:return"text-green"}},e.getFakenessColor=function(e){switch(!0){case e<=25:return"bg-danger";case e<=50:return"bg-warning";case e<=75:return"bg-yellow";default:return"bg-success"}},e.clear=function(){e.selectedText="",e.claims=null},e.sendFeedback=function(t){e.feedbackSelected=!0,$("#alert").fadeIn(),$("#feedback").fadeOut();var a={title:e.page.title,text:e.page.text,label:t};r.sendFb(a).then(function(e){console.log(e)},function(e){})},e.clickCb=function(t,a,n){if(t.target.checked)e.media[a].push(n);else{var l=e.media[a].indexOf(n);-1!==l&&e.media[a].splice(l,1)}console.log(e.media)},e.getDesc=function(e){o.getInfoScore(e).then(function(t){$("#"+e).prop("title",t.data),$("#"+e).tooltip("show")})},e.embedVideo=function(e){return e=e.replace("watch?v=","embed/"),d.trustAsResourceUrl(e)},e.sendFakeness=function(){e.feedbackSelected=!1,e.fakenessDone=!1,$("#gaugeFakeness").removeClass("animated fadeIn"),zingchart.exec("gaugeFakeness","destroy"),e.loadingFakeness=!0;var t=angular.copy(e.full_response);t.images=e.media.images,t.video=e.media.video,o.getFakeness(t).then(function(t){console.log(t.data),e.value=t.data.text[0],e.fakeValue=parseInt(100*e.value.FAKE),e.realValue=parseInt(100*e.value.REAL),e.full_response.video=t.data.videos,e.full_response.images=t.data.images,e.fakenessColor=e.getFakenessColor(e.realValue),console.log(e.full_response),zingchart.render({id:"gaugeFakeness",data:{type:"gauge","background-color":"#f7fafc","scale-r":{markers:[{type:"line",range:[50],"line-color":"grey","line-width":2,"line-style":"dashed",alpha:1}],aperture:200,values:"0:100:25",center:{size:5,"background-color":"#66CCFF #FFCCFF","border-color":"none"},ring:{size:10,rules:[{rule:"%v >= 0 && %v <= 25","background-color":"green"},{rule:"%v >= 25 && %v <= 50","background-color":"yellow"},{rule:"%v >= 50 && %v <= 75","background-color":"orange"},{rule:"%v >= 75 && %v <=100","background-color":"red"}]},labels:["REAL","","","","FAKE"],item:{"font-color":"black","font-family":"Open Sans, serif","font-size":13,"font-weight":"bold","font-style":"normal","offset-r":0,angle:"auto"}},gui:{contextMenu:{empty:!0}},plot:{tooltip:{visible:!1},csize:"5%",size:"100%","background-color":"#000000"},series:[{values:[e.fakeValue]}]},height:"100%",width:"100%"}),e.fakenessDone=!0,e.loadingFakeness=!1,$("#gaugeFakeness").addClass("animated fadeIn")},function(t){e.fakenessDone=!1,e.loadingFakeness=!1})}}]);