"use strict";app.controller("indexCtrl",["$scope","$http","$document","errorCode","crUrl","fakeness","feedback","claim","lang","alert","chart","$sce",function(e,a,t,n,i,s,o,l,r,d,c,g){e.fakenessDone=!1,e.loadingFakeness=!1,e.loadingAnalyzeUrl=!1,e.feedbackSelected=!1,e.showChart=!1,e.highlightedText="",e.selectedText="",e.fakenessColor="",e.sirenUrlNew="",e.videoAnalysisUrl=videoAnalysisUrl,e.full_response={},e.mediaDetails={},$(".alert").hide(),e.mediaToAnalyze=[],e.page={authors:[],publisher:[],url:"",text:"",title:"",date:"",lang:"",media:{images:[],video:[]}},e.media={images:[],video:[]};var u=["true","mostly-true","half-true"];angular.element(function(){e.loading=!1}),$("#gaugeFakeness").on("contextmenu",function(){return!1}),e.analyzeUrl=function(){e.loadingAnalyzeUrl=!0,e.fakenessDone=!1,e.media.images=[],e.media.video=[],i.analyzeUrl(e.page.url).then(function(a){console.log(a.data),e.full_response=a.data,e.page.title=a.data.headline,e.page.text=a.data.articleBody,e.page.publisher=a.data.publisher,e.page.authors=a.data.author,e.page.date=a.data.dateCreated,e.page.lang=a.data.language,e.page.media.images=a.data.images,e.page.media.video=a.data.video,e.sirenUrlNew=sirenUrl.replace("QUERYDACAMBIARE",e.full_response.identifier[0]),e.loadingAnalyzeUrl=!1},function(a){e.loadingAnalyzeUrl=!1,d.showAlert("Error")})},e.showSelectedText=function(){e.selectedText=e.getSelectionText()},e.showMediaDetails=function(a){e.mediaDetails=a,$("#json-viewer").jsonViewer(e.mediaDetails),$("#mediaDetailsModal").modal("show")},e.getSelectionText=function(){if(window.getSelection)try{var a=$("textarea").get(0);return e.highlightedText=a.value.substring(a.selectionStart,a.selectionEnd),e.highlightedText}catch(e){console.log("Cant get selection text")}document.selection&&"Control"!=document.selection.type&&(e.highlightedText=document.selection.createRange().text)},e.sendClaim=function(){var a={text:e.selectedText};l.getClaim(a).then(function(a){console.log(a.data),e.claims=a.data},function(){d.showAlert("Error")})},e.saveClaim=function(a){var t={claim:e.selectedText,label:a};l.saveClaim(t).then(function(e){d.showAlert("Success")},function(e){d.showAlert("Error")})},e.getClaimFakeness=function(e){return l.getFakeness(e,u)},e.getFakenessColor=function(e){return s.getFakenessColor(e)},e.getAuthorColor=function(e){return s.getAuthorFakeness(e)},e.clear=function(){e.selectedText="",e.claims=null},e.sendFeedback=function(a){e.feedbackSelected=!0,$("#alert").fadeIn(),$("#feedback").fadeOut();var t={title:e.page.title,text:e.page.text,label:a};o.sendFb(t).then(function(e){},function(e){})},e.clickCb=function(a,t,n){if(a.target.checked)e.media[t].push(n);else{var i=e.media[t].indexOf(n);-1!==i&&e.media[t].splice(i,1)}},e.getDesc=function(e){s.getInfoScore(e).then(function(a){$("#".concat(e)).prop("title",a.data),$("#".concat(e)).tooltip("show")})},e.embedVideo=function(e){return e=e.replace("watch?v=","embed/"),g.trustAsResourceUrl(e)},e.sendFakeness=function(){e.feedbackSelected=!1,e.fakenessDone=!1,$("#gaugeFakeness").removeClass("animated fadeIn"),zingchart.exec("gaugeFakeness","destroy");var a=angular.copy(e.full_response);a.images=e.media.images,a.video=e.media.video,e.loadingFakeness=!0,console.log("tosend",a),s.getFakeness(a).then(function(a){var t,n;e.fakenessValue=a.data.text[0],e.fakeValue=parseInt(100*e.fakenessValue.FAKE),e.realValue=parseInt(100*e.fakenessValue.REAL),e.page.media.images=a.data.images,e.page.media.video=a.data.videos,e.page.authors=a.data.authors,e.page.publisher=a.data.publishers,e.fakenessColor=s.getFakenessColor(e.realValue),c.renderChart(e.fakeValue),e.fakenessDone=!0,e.loadingFakeness=!1,$("#gaugeFakeness").addClass("animated fadeIn"),console.log("FAKENESS ->",a.data),console.log("PAGE ->",e.page),t=e.page.media,n=t.images.map(function(e){return e.image_id}),setInterval(function(){for(var a=function(a){s.getImageFakeness(n[a]).then(function(t){if("done"===t.data.status){var i=e.page.media.images.findIndex(function(e){return e.image_id===n[a]});console.log("PRIMA",e.page.media.images[i]),e.page.media.images[i]=t.data,console.log("DOPO",e.page.media.images[i]),n.splice(a,1)}})},t=0;t<n.length;t++)a(t)},5e3)},function(a){e.media.images=[],e.media.video=[],e.fakenessDone=!1,e.loadingFakeness=!1,d.showAlert("Error")})}}]);