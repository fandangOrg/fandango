app.controller("annotationCtrl",["$scope","$http","crUrl","lang","annotation","alert",function(e,n,t,a,o,l){function u(){$(".custom-control-input").prop("checked",!1),e.isLabelSelected=!1}function g(){$(".languageList").prop("selectedIndex",0),e.isLangSelected=!1}function r(){e.page.authors=[],e.page.title="",e.page.text="",e.page.url="",e.page.publisher=""}e.alertLabel="",e.selectedLanguage="en",e.optionLanguage="",e.tabSelected=1,e.countAnnotation=0,e.loadingAnalyzeUrl=!1,e.analyzeOk=!1,e.newExist=!0,e.isLabelSelected=!1,e.isLangSelected=!0,$(".alert").hide(),e.page={authors:[],publisher:"",url:"",text:"",title:""},angular.element(function(){a.getLanguages().then(function(n){e.languages=n.data,e.loading=!1})}),e.newLabel=function(n){e.isLabelSelected=!0},e.newLang=function(n){e.optionLanguage=n,e.isLangSelected=!0},e.changeTab=function(n){n!==e.tabSelected&&(e.tabSelected=n,r(),u(),g(),e.isLabelSelected=!1,e.analyzeStarted=!1,e.analyzeOk=!1)},e.changeTextNews=function(n){e.news=n.data,console.log(e.news),e.page.authors=e.news.authors,e.page.title=e.news.title,e.page.text=e.news.text,e.page.url=e.news.url,e.page.publisher=e.news.source_domain},e.getAuthorColor=function(e){switch(!0){case e<20:return"text-red";case e<40:return"text-warning";case e<80:return"text-yellow";case e>80:return"text-green"}},e.changeLanguage=function(n){if("False"!==n.active&&e.selectedLanguage!==n.language){e.selectedLanguage=n.language;var t={language:e.selectedLanguage};o.getCountAnnotation(t).then(function(n){e.countAnnotation=n.data}),o.goNext(e.selectedLanguage).then(function(n){e.changeTextNews(n),n.data.hasOwnProperty("END")?e.newExist=!1:(u(),g(),$("#btnStartAnalyze").addClass("animated fadeOut faster"),setTimeout(function(){$("#btnStartAnalyze").remove()},500),e.newExist=!0,e.analyzeStarted=!0)},function(e){l.showAlert("Error")})}},e.sendAnnotation=function(n,t,a){switch(a){case"auto":var i={id:e.news.id,label:n};e.alertLabel=n,o.getAutoAnnotation(i).then(function(n){u(),l.showAlert("Success");var t={language:e.selectedLanguage};o.getCountAnnotation(t).then(function(n){e.countAnnotation=n.data}),o.goNext(e.selectedLanguage).then(function(n){e.changeTextNews(n),n.data.hasOwnProperty("END")?e.newExist=!1:e.newExist=!0},function(e){l.showAlert("Error")})});break;case"manual":i={label:n,lang:e.optionLanguage,url:e.page.url};e.alertLabel=n,o.getManualAnnotation(i).then(function(n){l.showAlert("Success"),i={language:e.optionLanguage},o.getCountAnnotation(i).then(function(n){e.countAnnotation=n.data}),u(),g(),r()},function(e){l.showAlert("Error")});break;case"domain":i={list_url:t,label:n,lang:e.optionLanguage};e.alertLabel=n,o.getDomainAnnotation(i).then(function(n){l.showAlert("Success"),e.page.text="",u(),g()},function(e){l.showAlert("Error")})}},e.skipAnnotation=function(){o.goNext(e.selectedLanguage).then(function(n){e.changeTextNews(n),u()},function(e){l.showAlert("Error")})},e.startAnalyze=function(){var n={language:e.selectedLanguage};o.getCountAnnotation(n).then(function(n){e.countAnnotation=n.data,o.goNext(e.selectedLanguage).then(function(n){$("#btnStartAnalyze").addClass("animated fadeOut faster"),setTimeout(function(){$("#btnStartAnalyze").remove()},500),e.changeTextNews(n),e.analyzeStarted=!0},function(e){l.showAlert("Error")})})},e.analyzeUrl=function(){e.page.url&&(e.loadingAnalyzeUrl=!0,t.analyzeUrl(e.page.url).then(function(n){e.changeTextNews(n),console.log(e.page),e.analyzeOk=!0,e.loadingAnalyzeUrl=!1},function(n){l.showAlert("Error"),r(),e.analyzeOk=!1,e.loadingAnalyzeUrl=!1}))}}]);