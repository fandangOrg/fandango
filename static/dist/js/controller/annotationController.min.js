app.controller("annotationCtrl",["$scope","$http","crUrl","lang","annotation","alert",function(e,n,t,a,l,o){function r(){$(".custom-control-input").prop("checked",!1),e.isLabelSelected=!1}function s(){$(".languageList").prop("selectedIndex",0),e.isLangSelected=!1}function i(){e.page.authors=[],e.page.title="",e.page.text="",e.page.url="",e.page.publisher=""}e.alertLabel="",e.selectedLanguage="en",e.optionLanguage="",e.tabSelected=1,e.loadingAnalyzeUrl=!1,e.analyzeOk=!1,e.newExist=!0,e.isLabelSelected=!1,e.isLangSelected=!0,$(".alert").hide(),e.page={authors:[],publisher:"",url:"",text:"",title:""},angular.element(function(){a.getLanguages().then(function(n){e.languages=n.data,e.loading=!1})}),e.newLabel=function(n){e.isLabelSelected=!0},e.newLang=function(n){e.optionLanguage=n,e.isLangSelected=!0},e.changeTab=function(n){n!==e.tabSelected&&(e.tabSelected=n,i(),r(),s(),e.isLabelSelected=!1,e.analyzeStarted=!1,e.analyzeOk=!1)},e.changeTextNews=function(n){e.news=n.data,console.log(e.news),e.page.authors=e.news.authors,e.page.title=e.news.title,e.page.text=e.news.text,e.page.url=e.news.url,e.page.publisher=e.news.source_domain},e.changeLanguage=function(n){"False"!==n.active&&e.selectedLanguage!==n.language&&(e.selectedLanguage=n.language,l.goNext(e.selectedLanguage).then(function(n){e.changeTextNews(n),n.data.hasOwnProperty("END")?e.newExist=!1:(r(),s(),$("#btnStartAnalyze").addClass("animated fadeOut faster"),setTimeout(function(){$("#btnStartAnalyze").remove()},500),e.newExist=!0,e.analyzeStarted=!0)},function(e){o.showAlert("Error")}))},e.sendAnnotation=function(n,t,a){switch(a){case"auto":var g={id:e.news.id,label:n};e.alertLabel=n,l.getAutoAnnotation(g).then(function(n){r(),o.showAlert("Success"),l.goNext(e.selectedLanguage).then(function(n){e.changeTextNews(n),n.data.hasOwnProperty("END")?e.newExist=!1:e.newExist=!0},function(e){o.showAlert("Error")})});break;case"manual":g={label:n,lang:e.optionLanguage,url:e.page.url};e.alertLabel=n,l.getManualAnnotation(g).then(function(e){o.showAlert("Success"),r(),s(),i()},function(e){o.showAlert("Error")});break;case"domain":g={list_url:t,label:n,lang:e.optionLanguage};e.alertLabel=n,l.getDomainAnnotation(g).then(function(n){o.showAlert("Success"),e.page.text="",r(),s()},function(e){o.showAlert("Error")})}},e.skipAnnotation=function(){l.goNext(e.selectedLanguage).then(function(n){e.changeTextNews(n),r()},function(e){o.showAlert("Error")})},e.startAnalyze=function(){l.goNext(e.selectedLanguage).then(function(n){$("#btnStartAnalyze").addClass("animated fadeOut faster"),setTimeout(function(){$("#btnStartAnalyze").remove()},500),e.changeTextNews(n),e.analyzeStarted=!0},function(e){o.showAlert("Error")})},e.analyzeUrl=function(){e.page.url&&(e.loadingAnalyzeUrl=!0,t.analyzeUrl(e.page.url).then(function(n){e.changeTextNews(n),console.log(e.page),e.analyzeOk=!0,e.loadingAnalyzeUrl=!1},function(n){o.showAlert("Error"),i(),e.analyzeOk=!1,e.loadingAnalyzeUrl=!1}))}}]);