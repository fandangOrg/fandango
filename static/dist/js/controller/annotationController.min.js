app.controller("annotationCtrl",["$scope","$http","crUrl","lang","annotation","alert",function(e,t,n,a,l,o){function r(){$(".custom-control-input").prop("checked",!1),e.isLabelSelected=!1}function s(){$(".languageList").prop("selectedIndex",0),e.isLangSelected=!1}function i(){e.page.authors=[],e.page.title="",e.page.text="",e.page.url="",e.page.publisher=""}e.alertLabel="",e.selectedLanguage="en",e.optionLanguage="",e.tabSelected=1,e.loadingAnalyzeUrl=!1,e.analyzeOk=!1,e.newExist=!0,e.isLabelSelected=!1,e.isLangSelected=!0,$(".alert").hide(),e.page={authors:[],publisher:"",url:"",text:"",title:""},angular.element(function(){a.getLanguages().then(function(t){e.languages=t.data,e.loading=!1})}),e.newLabel=function(t){e.isLabelSelected=!0},e.newLang=function(t){e.optionLanguage=t,e.isLangSelected=!0},e.changeTab=function(t){t!==e.tabSelected&&(e.tabSelected=t,i(),r(),s(),e.isLabelSelected=!1,e.analyzeStarted=!1,e.analyzeOk=!1)},e.changeTextNews=function(t){e.news=t.data,console.log(e.news),e.page.authors=e.news.authors,e.page.title=e.news.title,e.page.text=e.news.text,e.page.url=e.news.url,e.page.publisher=e.news.source_domain},e.getAuthorColor=function(e){switch(!0){case e<20:return"text-red";case e<40:return"text-warning";case e<80:return"text-yellow";case e>80:return"text-green"}},e.changeLanguage=function(t){"False"!==t.active&&e.selectedLanguage!==t.language&&(e.selectedLanguage=t.language,l.goNext(e.selectedLanguage).then(function(t){e.changeTextNews(t),t.data.hasOwnProperty("END")?e.newExist=!1:(r(),s(),$("#btnStartAnalyze").addClass("animated fadeOut faster"),setTimeout(function(){$("#btnStartAnalyze").remove()},500),e.newExist=!0,e.analyzeStarted=!0)},function(e){o.showAlert("Error")}))},e.sendAnnotation=function(t,n,a){switch(a){case"auto":var u={id:e.news.id,label:t};e.alertLabel=t,l.getAutoAnnotation(u).then(function(t){r(),o.showAlert("Success"),l.goNext(e.selectedLanguage).then(function(t){e.changeTextNews(t),t.data.hasOwnProperty("END")?e.newExist=!1:e.newExist=!0},function(e){o.showAlert("Error")})});break;case"manual":u={label:t,lang:e.optionLanguage,url:e.page.url};e.alertLabel=t,l.getManualAnnotation(u).then(function(e){o.showAlert("Success"),r(),s(),i()},function(e){o.showAlert("Error")});break;case"domain":u={list_url:n,label:t,lang:e.optionLanguage};e.alertLabel=t,l.getDomainAnnotation(u).then(function(t){o.showAlert("Success"),e.page.text="",r(),s()},function(e){o.showAlert("Error")})}},e.skipAnnotation=function(){l.goNext(e.selectedLanguage).then(function(t){e.changeTextNews(t),r()},function(e){o.showAlert("Error")})},e.startAnalyze=function(){l.goNext(e.selectedLanguage).then(function(t){$("#btnStartAnalyze").addClass("animated fadeOut faster"),setTimeout(function(){$("#btnStartAnalyze").remove()},500),e.changeTextNews(t),e.analyzeStarted=!0},function(e){o.showAlert("Error")})},e.analyzeUrl=function(){e.page.url&&(e.loadingAnalyzeUrl=!0,n.analyzeUrl(e.page.url).then(function(t){e.changeTextNews(t),console.log(e.page),e.analyzeOk=!0,e.loadingAnalyzeUrl=!1},function(t){o.showAlert("Error"),i(),e.analyzeOk=!1,e.loadingAnalyzeUrl=!1}))}}]);