"use strict";app.controller("annotationCtrl",["$scope","$http","crUrl","lang","annotation","alert",function(e,t,n,a,o,l){function u(){$(".custom-control-input").prop("checked",!1),e.isLabelSelected=!1}function g(){$(".languageList").prop("selectedIndex",0),e.isLangSelected=!1}function r(){e.page.authors=[],e.page.title="",e.page.text="",e.page.url="",e.page.publisher=""}e.alertLabel="",e.selectedLanguage="en",e.optionLanguage="",e.tabSelected=1,e.countAnnotation=0,e.loadingAnalyzeUrl=!1,e.analyzeOk=!1,e.newExist=!0,e.isLabelSelected=!1,e.isLangSelected=!0,$(".alert").hide(),e.page={authors:[],publisher:"",url:"",text:"",title:"",authorName:""},angular.element(function(){a.getLanguages().then(function(t){e.languages=t.data,e.loading=!1})}),e.newLabel=function(t){e.isLabelSelected=!0},e.newLang=function(t){e.optionLanguage=t,e.isLangSelected=!0},e.changeTab=function(t){t!==e.tabSelected&&(e.tabSelected=t,r(),u(),g(),e.isLabelSelected=!1,e.analyzeStarted=!1,e.analyzeOk=!1)},e.changeTextNews=function(t){e.news=t.data,console.log(e.news),e.page.authors=e.news.authors,e.page.title=e.news.title,e.page.text=e.news.text,e.page.url=e.news.url,e.page.publisher=e.news.source_domain},e.getAuthorColor=function(e){switch(!0){case e<20:return"text-red";case e<40:return"text-warning";case e<80:return"text-yellow";case e>80:return"text-green"}},e.changeLanguage=function(t){if("False"!==t.active&&e.selectedLanguage!==t.language)if(e.page.authorName){e.selectedLanguage=t.language;var n={language:e.selectedLanguage};o.getCountAnnotation(n).then(function(t){e.countAnnotation=t.data}),o.goNext(e.selectedLanguage,e.page.authorName).then(function(t){e.changeTextNews(t),t.data.hasOwnProperty("END")?e.newExist=!1:(u(),g(),$("#btnStartAnalyze").addClass("animated fadeOut faster"),setTimeout(function(){$("#btnStartAnalyze").remove()},500),e.newExist=!0,e.analyzeStarted=!0)},function(e){l.showAlert("Error")})}else l.showAlert("Warning")},e.sendAnnotation=function(t,n,a){switch(a){case"auto":var i={id:e.news.id,label:t,author:e.page.authorName,language:e.selectedLanguage};e.alertLabel=t,o.getAutoAnnotation(i).then(function(t){u(),l.showAlert("Success");var n={language:e.selectedLanguage};o.getCountAnnotation(n).then(function(t){e.countAnnotation=t.data}),o.goNext(e.selectedLanguage,e.page.authorName).then(function(t){e.changeTextNews(t),t.data.hasOwnProperty("END")?e.newExist=!1:e.newExist=!0},function(e){l.showAlert("Error")})});break;case"manual":i={label:t,lang:e.optionLanguage,url:e.page.url};e.alertLabel=t,o.getManualAnnotation(i).then(function(t){l.showAlert("Success"),i={language:e.optionLanguage},o.getCountAnnotation(i).then(function(t){e.countAnnotation=t.data}),u(),g(),r()},function(e){l.showAlert("Error")});break;case"domain":i={list_url:n,label:t,lang:e.optionLanguage};e.alertLabel=t,o.getDomainAnnotation(i).then(function(t){l.showAlert("Success"),e.page.text="",u(),g()},function(e){l.showAlert("Error")})}},e.skipAnnotation=function(){o.goNext(e.selectedLanguage,e.page.authorName).then(function(t){e.changeTextNews(t),u()},function(e){l.showAlert("Error")})},e.startAnalyze=function(){var t={language:e.selectedLanguage};o.getCountAnnotation(t).then(function(t){e.countAnnotation=t.data,o.goNext(e.selectedLanguage,e.page.authorName).then(function(t){$("#btnStartAnalyze").addClass("animated fadeOut faster"),setTimeout(function(){$("#btnStartAnalyze").remove()},500),e.changeTextNews(t),e.analyzeStarted=!0},function(e){l.showAlert("Error")})})},e.analyzeUrl=function(){e.page.url&&(e.loadingAnalyzeUrl=!0,n.analyzeUrl(e.page.url).then(function(t){e.changeTextNews(t),console.log(e.page),e.analyzeOk=!0,e.loadingAnalyzeUrl=!1},function(t){l.showAlert("Error"),r(),e.analyzeOk=!1,e.loadingAnalyzeUrl=!1}))}}]);