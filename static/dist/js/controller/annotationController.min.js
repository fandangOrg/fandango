app.controller("annotationCtrl",["$scope","$http","crUrl","lang","annotation",function(e,n,a,t,l){function o(){$(".custom-control-input").prop("checked",!1),e.isLabelSelected=!1}function i(){$(".languageList").prop("selectedIndex",0),e.isLangSelected=!1}function c(e){$("#alert"+e).fadeTo(1500,500).slideUp(500,function(){$(".alert").slideUp(500)})}e.alertLabel="",e.selectedLanguage="en",e.optionLanguage="",e.tabSelected=1,e.loadingAnalyzeUrl=!1,e.analyzeOk=!1,e.newExist=!0,e.isLabelSelected=!1,e.isLangSelected=!0,$(".alert").hide(),e.page={author:"",publisher:"",url:"",text:"",title:""},e.newLabel=function(n){e.isLabelSelected=!0},e.newLang=function(n){e.optionLanguage=n,e.isLangSelected=!0},angular.element(function(){t.getLanguages().then(function(n){e.languages=n.data,e.loading=!1})}),e.changeTab=function(n){n!==e.tabSelected&&(e.tabSelected=n,e.page.author="",e.page.title="",e.page.text="",e.page.url="",e.page.publisher="",o(),i(),e.isLabelSelected=!1,e.analyzeStarted=!1,e.analyzeOk=!1)},e.changeTextNews=function(n){e.news=n.data,console.log(e.news),e.page.author=e.news.authors,e.page.title=e.news.title,e.page.text=e.news.text,e.page.url=e.news.url,e.page.publisher=e.news.source_domain},e.changeLanguage=function(n){"False"!==n.active&&e.selectedLanguage!==n.language&&(e.selectedLanguage=n.language,l.goNext(e.selectedLanguage).then(function(n){e.changeTextNews(n),n.data.hasOwnProperty("END")?e.newExist=!1:(o(),i(),$("#btnStartAnalyze").addClass("animated fadeOut faster"),setTimeout(function(){$("#btnStartAnalyze").remove()},500),e.newExist=!0,e.analyzeStarted=!0)},function(e){c("Error")}))},e.sendAnnotation=function(n,a,t){switch(t){case"auto":if(!e.isLabelSelected)return;var g={id:e.news.id,label:n};e.alertLabel=n,l.getAutoAnnotation(g).then(function(n){o(),c("Success"),l.goNext(e.selectedLanguage).then(function(n){e.changeTextNews(n),n.data.hasOwnProperty("END")?e.newExist=!1:e.newExist=!0})});break;case"manual":if(!e.isLabelSelected||!e.isLangSelected)return;g={label:n,lang:e.optionLanguage,url:e.page.url};e.alertLabel=n,console.log(g),l.getManualAnnotation(g).then(function(e){c("Success"),o(),i(),console.log(e)});break;case"domain":if(!a||!e.isLabelSelected||!e.isLangSelected)return;g={list_url:a,label:n};e.alertLabel=n,l.getDomainAnnotation(g).then(function(n){c("Success"),e.page.text="",o(),i(),console.log(n)})}},e.skipAnnotation=function(){l.goNext(e.selectedLanguage).then(function(n){e.changeTextNews(n),o()})},e.startAnalyze=function(){$("#btnStartAnalyze").addClass("animated fadeOut faster"),setTimeout(function(){$("#btnStartAnalyze").remove()},500),l.goNext(e.selectedLanguage).then(function(n){e.changeTextNews(n),e.analyzeStarted=!0})},e.analyzeUrl=function(){if(e.page.url){e.loadingAnalyzeUrl=!0;var n=e.page.url;a.analyzeUrl(n).then(function(n){e.changeTextNews(n),console.log(e.page),e.analyzeOk=!0,e.loadingAnalyzeUrl=!1},function(n){c("Error"),e.analyzeOk=!1,e.loadingAnalyzeUrl=!1})}}}]);